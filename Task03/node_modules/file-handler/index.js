var spawn = require('child_process').spawn,
	fs = require('fs'),
	path = require('path'),
	self = this;

var getCurrentDate = function() {
	var date = new Date;
	var day = date.getDate(),
	year = date.getFullYear(),
	month = date.getMonth();

	return day + '-' + month + '-' + year;
}

self.copy = function(fileName) {
	spawn('cmd', ['/$', '/C', 'copy', fileName, getCurrentDate() + '-' + fileName]);
}

self.del = function(fileName) {
	spawn('cmd', [ '/$', '/C', 'del', fileName ]);
	del.stdout.pipe(process.stdout);
}

self.getFilesList = function(dirName) {
	var filesList = '';

	fs.readdir(dirName, function(err, files) {
		for (var item in files) {
			
			if (path.extname(files[item]) === '.txt') {
				filesList += ' ' + files[item] + '';
			}
		}

		console.log(filesList);
	});
}

var handleAction = function(action, fileName) {
	switch (action) {
		case 'copy':
			return self.copy(fileName);
			break;

		case 'del':
			return self.del(fileName);
			break;

		case 'dir':
			return self.getFilesList(fileName);

		default:
			return 'Unknown Method';
			break;
	}
}
exports.handleAction = handleAction;